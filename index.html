<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code 批次生成工具 (整合版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for file input to hide default button */
        input[type="file"]::file-selector-button {
            display: none;
        }
        input[type="file"] {
            cursor: pointer;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 sm:p-8 text-gray-800">

    <div class="max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-2xl shadow-xl border border-gray-200">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-center text-indigo-700 mb-8">
            QR Code 批次生成工具
        </h1>

        <div class="mb-8 bg-gray-50 p-6 rounded-xl border border-gray-200 shadow-inner">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">輸入內容</h2>
            <textarea id="inputText" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition duration-200 ease-in-out resize-y min-h-[150px] text-base" placeholder="請輸入要轉換的連結或文字，每行一個項目。"></textarea>
            <div class="mt-4 flex flex-col sm:flex-row items-center space-y-3 sm:space-y-0 sm:space-x-4">
                <label for="fileUpload" class="w-full sm:w-auto flex items-center justify-center px-6 py-3 border border-indigo-400 rounded-lg shadow-sm text-lg font-medium text-indigo-700 bg-indigo-100 hover:bg-indigo-200 cursor-pointer transition duration-200 ease-in-out">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 h-5 w-5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" x2="12" y1="3" y2="15"></line></svg>
                    上傳 .txt 或 .csv 檔案
                    <input type="file" id="fileUpload" accept=".txt,.csv" class="hidden">
                </label>
                <span class="text-gray-500 text-sm">（每行一個連結/文字）</span>
            </div>
        </div>

        <div id="qrCodeSettings" class="mb-8 bg-blue-50 p-6 rounded-xl border border-blue-200 shadow-inner">
            <h2 class="text-2xl font-semibold text-blue-700 mb-4">QR Code 設定</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="qrSize" class="block text-gray-700 text-sm font-bold mb-2">尺寸 (像素):</label>
                    <input type="number" id="qrSize" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400" value="256" min="64" max="1024">
                </div>
                <div>
                    <label for="qrFgColor" class="block text-gray-700 text-sm font-bold mb-2">前景顏色:</label>
                    <input type="color" id="qrFgColor" class="w-full h-12 p-1 border border-gray-300 rounded-lg" value="#000000">
                </div>
                <div>
                    <label for="qrBgColor" class="block text-gray-700 text-sm font-bold mb-2">背景顏色:</label>
                    <input type="color" id="qrBgColor" class="w-full h-12 p-1 border border-gray-300 rounded-lg" value="#FFFFFF">
                </div>
                <div>
                    <label for="qrErrorCorrection" class="block text-gray-700 text-sm font-bold mb-2">錯誤校正等級:</label>
                    <select id="qrErrorCorrection" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400">
                        <option value="L">L (低)</option>
                        <option value="M" selected>M (中)</option>
                        <option value="Q">Q (高)</option>
                        <option value="H">H (最高)</option>
                    </select>
                </div>
                <div class="md:col-span-2">
                    <label for="logoUpload" class="block text-gray-700 text-sm font-bold mb-2">Logo 圖片 (選填):</label>
                    <input type="file" id="logoUpload" accept="image/*" class="w-full p-3 border border-gray-300 rounded-lg file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    <div id="logoPreviewContainer" class="mt-4 hidden items-center space-x-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-8 w-8 text-blue-500"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect><circle cx="9" cy="9" r="2"></circle><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path></svg>
                        <span class="text-gray-600">Logo 已上傳。</span>
                        <label for="logoSizeRatio" class="block text-gray-700 text-sm font-bold">Logo 尺寸比例:</label>
                        <input type="range" id="logoSizeRatio" min="0.1" max="0.4" step="0.05" value="0.2" class="w-32 h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer">
                        <span id="logoSizeRatioValue" class="text-gray-600">20%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="text-center mb-8">
            <button id="generateButton" class="px-8 py-4 bg-indigo-600 text-white text-xl font-bold rounded-full shadow-lg hover:bg-indigo-700 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-300">
                <span id="buttonText">開始生成 QR Code</span>
                <span id="loadingSpinner" class="hidden items-center">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    處理中...
                </span>
            </button>
            <p id="errorMessage" class="text-red-600 mt-4 text-center font-medium hidden"></p>
        </div>

        <div id="resultsContainer" class="bg-gray-50 p-6 rounded-xl border border-gray-200 shadow-inner mt-8 hidden">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">生成結果</h2>

            <div id="qrCodeResults">
                <button id="downloadQrCodesZip" class="mb-4 px-6 py-3 bg-green-500 text-white font-bold rounded-lg shadow-md hover:bg-green-600 transition duration-200 ease-in-out flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 h-5 w-5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" x2="12" y1="15" y2="3"></line></svg>
                    下載所有 QR Code (ZIP)
                </button>
                <div id="qrCodeGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
            </div>
        </div>
    </div>

    <script>
    !function(){function t(t){this.mode=s.MODE_8BIT_BYTE,this.data=t}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function r(t,e){if(void 0===t.length)throw new Error(t.length+"/"+e);for(var r=0;r<t.length&&0==t[r];)r++;this.num=new Array(t.length-r+e);for(var i=0;i<t.length-r;i++)this.num[i]=t[i+r]}function i(t,e){this.totalCount=t,this.dataCount=e}function n(t,e){switch(e){case c.L:return h[4*(t-1)+0];case c.M:return h[4*(t-1)+1];case c.Q:return h[4*(t-1)+2];case c.H:return h[4*(t-1)+3];default:return}}function a(t,e){for(var r=t.getModuleCount(),i=t.getModuleCount(),n=Math.floor((r+i)/2),a=Math.max(r,i),o=Math.min(r,i),s=e,l=n-s,u=n+s,f=o-s,g=a-s,d=new Array,p=0;p<=s;p++){d[p]=new Array;for(var v=0;v<=s;v++)d[p][v]=!1}for(var m=0;m<t.getModuleCount();m++)for(var y=0;y<t.getModuleCount();y++)if(m>l&&m<u&&y>l&&y<u)d[m-l-1][y-l-1]=!0;else if(m>f&&m<g&&y>f&&y<g)d[m-f-1][y-f-1]=!0;return d}function o(t){for(var e=0,r=0,i=0;i<8;i++){e<<=1;var n=t.get(i);n&&(e|=n)}for(var a=0;a<8;a++)r^=g[a][(e>>a)%2];for(;r>0;)r>>=1,e<<=1;return e}var s={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},c={L:1,M:0,Q:3,H:2},l={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},u={};u.getBCHTypeInfo=function(t){for(var e=t<<10;7973^e-function(t){for(var e=0;0!=t;)e++,t>>>=1;return e}(e)>=0;)e^=7973<<function(t){for(var e=0;0!=t;)e++,t>>>=1;return e}(e)-12;return(t<<10|e)^21522},u.getBCHTypeNumber=function(t){for(var e=t<<12;4096^e-function(t){for(var e=0;0!=t;)e++,t>>>=1;return e}(e)>=0;)e^=4096<<function(t){for(var e=0;0!=t;)e++,t>>>=1;return e}(e)-13;return t<<12|e};var f=[[],[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[1,70,34],[1,70,26],[1,100,80],[1,100,64],[1,100,48],[1,100,36],[1,134,108],[1,134,86],[1,134,68],[1,134,54],[1,172,136],[1,172,108],[1,172,86],[1,172,68],[1,212,170,116,58],[1,212,136,86,43],[1,212,100,62,31],[1,212,76,46,23],[1,271,217,155,78],[1,271,171,111,56],[1,271,127,81,41],[1,271,97,61,31],[1,331,265,187,94],[1,331,211,131,66],[1,331,151,97,49],[1,331,115,75,38],[1,403,323,225,113],[1,403,257,169,85],[1,403,187,115,58],[1,403,145,93,47],[1,501,401,281,141],[1,501,313,209,105],[1,501,241,153,77],[1,501,185,113,57],[1,583,467,331,166],[1,583,373,253,127],[1,583,283,181,91],[1,583,229,141,71],[1,651,521,365,183],[1,651,411,285,143],[1,651,315,203,102],[1,651,243,159,80],[1,777,621,433,217],[1,777,489,337,169],[1,777,369,241,121],[1,777,297,189,95],[1,857,685,481,241],[1,857,549,381,191],[1,857,417,273,137],[1,857,333,213,107],[1,993,795,553,277],[1,993,627,429,215],[1,993,477,315,158],[1,993,381,243,122],[1,1101,881,613,307],[1,1101,689,481,241],[1,1101,533,353,177],[1,1101,437,281,141]],g=[[1,1,1,1,1,1,1,1],[1,0,1,0,1,0,1,0],[1,1,0,0,1,1,0,0],[1,0,0,1,1,0,0,1],[1,1,1,1,0,0,0,0],[1,0,1,0,0,1,0,1],[1,1,0,0,0,0,1,1,1],[1,0,0,1,0,1,1,0]],d={};d.getPatternPosition=function(t){return f[t-1]},d.getMask=function(t,e,r){switch(t){case l.PATTERN000:return(e+r)%2==0;case l.PATTERN001:return e%2==0;case l.PATTERN010:return r%3==0;case l.PATTERN011:return(e+r)%3==0;case l.PATTERN100:return(Math.floor(e/2)+Math.floor(r/3))%2==0;case l.PATTERN101:return e*r%2+e*r%3==0;case l.PATTERN110:return(e*r%2+e*r%3)%2==0;case l.PATTERN111:return(e*r%3+(e+r)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},d.getErrorCorrectPolynomial=function(t){for(var e=new r([1],0),i=0;i<t;i++)e=e.multiply(new r([1,p.gexp(i)],0));return e};var p={};p.glog=function(t){if(t<1)throw new Error("glog("+-1+")");return p.LOG_TABLE[t]},p.gexp=function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return p.EXP_TABLE[t]},p.EXP_TABLE=new Array(256),p.LOG_TABLE=new Array(256);for(var v=0;v<8;v++)p.EXP_TABLE[v]=1<<v;for(v=8;v<256;v++)p.EXP_TABLE[v]=p.EXP_TABLE[v-4]^p.EXP_TABLE[v-5]^p.EXP_TABLE[v-6]^p.EXP_TABLE[v-8];for(v=0;v<255;v++)p.LOG_TABLE[p.EXP_TABLE[v]]=v;var h=[[10,7,17,13],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[6,28,26],[6,28,22],[6,26,20],[6,26,18],[6,30,26],[6,30,24],[6,28,24],[6,28,22],[6,28,24,20],[6,28,24,20],[6,26,22,18],[6,26,22,18],[6,30,26,22],[6,30,24,20],[6,28,24,20],[6,28,24,20],[6,30,28,24],[6,30,26,22],[6,28,26,22],[6,28,26,22],[6,30,28,24],[6,30,28,24],[6,30,26,22,18],[6,30,26,22,18],[6,30,28,24,20],[6,30,28,24,20],[6,30,28,24,20],[6,30,28,24,20]];t.prototype={getLength:function(){return this.data.length},write:function(t){for(var e=0;e<this.data.length;e++)t.put(this.data.charCodeAt(e),8)}},e.prototype={getModuleCount:function(){return this.moduleCount},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},addData:function(t){this.dataList.push(t),this.dataCache=null},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,r){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++){this.modules[i]=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++)this.modules[i][n]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,r),this.typeNumber>=7&&this.setupTypeNumber(t);var a=this.createData(this.typeNumber,this.errorCorrectLevel,this.dataList);this.mapData(a,r)},setupPositionProbePattern:function(t,e){for(var r=-1;r<=7;r++)if(!(t+r<=-1||this.moduleCount<=t+r))for(var i=-1;i<=7;i++)e+i<=-1||this.moduleCount<=e+i||(r>=0&&r<=6&&(0==i||6==i)||i>=0&&i<=6&&(0==r||6==r)||r>=2&&r<=4&&i>=2&&i<=4?this.modules[t+r][e+i]=!0:this.modules[t+r][e+i]=!1)},getBestMaskPattern:function(){for(var t=0,e=0,r=0;r<8;r++){this.makeImpl(!0,r);var i=d.getLostPoint(this);(0==r||t>i)&&(t=i,e=r)}return e},createMovieClip:function(t,e,r){var i=t.createEmptyMovieClip(e,r),n=1;this.make();for(var a=0;a<this.modules.length;a++)for(var o=a*n,s=0;s<this.modules[a].length;s++){var c=s*n;this.modules[a][s]&&(i.beginFill(0,100),i.moveTo(c,o),i.lineTo(c+n,o),i.lineTo(c+n,o+n),i.lineTo(c,o+n),i.endFill())}return i},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=d.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var r=0;r<t.length;r++){var i=t[e],n=t[r];if(null==this.modules[i][n])for(var a=-2;a<=2;a++)for(var o=-2;o<=2;o++)a==-2||2==a||o==-2||2==o||0==a&&0==o?this.modules[i+a][n+o]=!0:this.modules[i+a][n+o]=!1}},setupTypeNumber:function(t){for(var e=u.getBCHTypeNumber(this.typeNumber),r=0;r<18;r++){var i=!t&&1==(e>>r&1);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=i}for(r=0;r<18;r++){i=!t&&1==(e>>r&1);this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=i}},setupTypeInfo:function(t,e){for(var r=this.errorCorrectLevel<<3|e,i=u.getBCHTypeInfo(r),n=0;n<15;n++){var a=!t&&1==(i>>n&1);n<6?this.modules[n][8]=a:n<8?this.modules[n+1][8]=a:this.modules[this.moduleCount-15+n][8]=a}for(n=0;n<15;n++){a=!t&&1==(i>>n&1);n<8?this.modules[8][this.moduleCount-n-1]=a:n<9?this.modules[8][15-n-1+1]=a:this.modules[8][15-n-1]=a}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var r=0,i=-1,n=this.moduleCount-1,a=7,o=0,s=this.moduleCount-1;s>0;s-=2)for(6==s&&s--;;){for(var c=0;c<2;c++)if(null==this.modules[n][s-c]){var l=!1;o<t.length&&(l=1==(t[o]>>>r&1));d.getMask(e,n,s-c)&&(l=!l),this.modules[n][s-c]=l,r++,8==r&&(r=0,o++)}if((n+=i)<0||this.moduleCount<=n){n-=i,i=-i;break}}},e.createData=function(t,r,a){for(var o=i.getRSBlocks(t,r),s=new(function(){this.buffer=[],this.length=0,this.push=function(t,e){var r=Math.floor(t/e),i=t%e;this.buffer.push(r,i)},this.get=function(t){var e=Math.floor(t/2),r=t%2;return this.buffer[2*e]<<r+1&2|this.buffer[2*e+1]>>7-r&1},this.getLengthInBits=function(){var t=0;return this.buffer.forEach(function(e){t+=1==e%2?8:16}),t}}),c=0;c<a.length;c++){var l=a[c];s.put(l.mode,4),s.put(l.getLength(),function(t,e){if(t>=1&&t<=9)switch(e){case s.MODE_NUMBER:return 10;case s.MODE_ALPHA_NUM:return 9;case s.MODE_8BIT_BYTE:return 8;case s.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t>=10&&t<=26)switch(e){case s.MODE_NUMBER:return 12;case s.MODE_ALPHA_NUM:return 11;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t>=27&&t<=40))throw new Error("length:"+t);switch(e){case s.MODE_NUMBER:return 14;case s.MODE_ALPHA_NUM:return 13;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}(l.mode,t)),l.write(s)}for(var u=0,f=0;f<o.length;f++)u+=o[f].dataCount;if(s.getLengthInBits()>8*u)throw new Error("code length overflow. ("+s.getLengthInBits()+">"+8*u+")");for(s.getLengthInBits()+4<=8*u&&s.put(0,4);s.getLengthInBits()%8!=0;)s.putBit(!1);for(;;){if(s.getLengthInBits()>=8*u)break;s.put(236,8),s.put(17,8)}return e.createBytes(s,o)},e.createBytes=function(t,e){for(var i=0,n=0,a=0,o=new Array(e.length),s=new Array(e.length),c=0;c<e.length;c++){var l=e[c].dataCount,u=e[c].totalCount-l;n=Math.max(n,l),a=Math.max(a,u),o[c]=new Array(l);for(var f=0;f<o[c].length;f++)o[c][f]=255&t.buffer[f+i];i+=l;var g=d.getErrorCorrectPolynomial(u),h=new r(o[c],g.getLength()-1).mod(g);s[c]=new Array(g.getLength()-1);for(f=0;f<s[c].length;f++){var p=f+h.getLength()-s[c].length;s[c][f]=p>=0?h.num[p]:0}}for(var v=new Array(e[0].totalCount),m=0,y=0;y<n;y++)for(c=0;c<e.length;c++)y<o[c].length&&(v[m++]=o[c][y]);for(y=0;y<a;y++)for(c=0;c<e.length;c++)y<s[c].length&&(v[m++]=s[c][y]);return v},r.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),i=0;i<this.getLength();i++)for(var n=0;n<t.getLength();n++)e[i+n]^=p.gexp(p.glog(this.get(i))+p.glog(t.get(n)));return new r(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=p.glog(this.get(0))-p.glog(t.get(0)),i=new Array(this.getLength()),n=0;n<this.getLength();n++)i[n]=this.get(n);for(n=0;n<t.getLength();n++)i[n]^=p.gexp(p.glog(t.get(n))+e);return new r(i,0).mod(t)}},i.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[1,70,34],[1,70,26],[1,100,80],[1,100,64],[1,100,48],[1,100,36],[1,134,108],[1,134,86],[1,134,68],[1,134,54],[1,172,136],[1,172,108],[1,172,86],[1,172,68],[2,196,156],[2,196,124],[4,244,192],[4,244,152],[2,292,232],[4,292,180],[4,352,280],[4,352,224],[4,408,312],[4,408,248],[5,480,384],[5,480,300],[4,532,424],[4,532,336],[6,600,480],[6,600,384],[8,644,512],[8,644,408],[10,750,600],[9,750,480],[8,816,648],[8,816,512],[12,900,720],[12,900,560],[10,992,792],[10,992,624],[12,1104,888],[16,1104,688],[14,1250,1e3],[16,1250,784],[18,1352,1080],[17,1352,864],[14,1440,1152],[14,1440,912],[20,1570,1256],[19,1570,992],[18,1728,1376],[22,1728,1104],[20,1856,1488],[25,1856,1184],[26,2040,1632],[25,2040,1312],[24,2132,1704],[28,2132,1348],[28,2304,1824],[28,2304,1456],[28,2448,1968],[28,2448,1584],[30,2640,2112],[28,2640,1680],[30,2808,2248],[28,2808,1800]],i.getRSBlocks=function(t,e){var r=n(t,e);if(void 0===r)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var a=r.length/3,o=[],s=0;s<a;s++)for(var c=r[3*s+0],l=r[3*s+1],u=r[3*s+2],f=0;f<c;f++)o.push(new i(l,u));return o};var m=function(){var t,e=document.createElement("canvas"),r="undefined"!=typeof G_vmlCanvasManager;return function(i,n){try{t=n,r&&G_vovmlCanvasManager.initElement(e);var a=e.getContext("2d");a.clearRect(0,0,e.width,e.height),i.make(),function(e,r){var i=t.size,n=t.margin,a=r.getModuleCount();e.width=i+2*n,e.height=i+2*n;var o=e.getContext("2d");o.fillStyle=t.background,o.fillRect(0,0,e.width,e.height),o.fillStyle=t.foreground;var s=i/a;for(var c=0;c<a;c++)for(var l=0;l<a;l++)r.isDark(l,c)&&o.fillRect(c*s+n,l*s+n,s,s)}(e,i),function(e,t){var r=t.logo;if(r){var i=e.getContext("2d"),n=new Image;n.onload=function(){var a=t.size,o=t.logoSize,s=t.logoMargin,c=t.logoCornerRadius;o=o||a*.2;var l=(a-o)/2;s=s||0;var u=t.logoBackground;c=c||0,u=u||"#ffffff",i.fillStyle=u,function(t,e,r,i,n){t.beginPath(),t.moveTo(e+n,r),t.lineTo(e+i-n,r),t.quadraticCurveTo(e+i,r,e+i,r+n),t.lineTo(e+i,r+i-n),t.quadraticCurveTo(e+i,r+i,e+i-n,r+i),t.lineTo(e+n,r+i),t.quadraticCurveTo(e,r+i,e,r+i-n),t.lineTo(e,r+n),t.quadraticCurveTo(e,r,e+n,r),t.closePath(),t.fill()}(i,l-s,l-s,o+2*s,c),i.drawImage(n,l,l,o,o),t.onrender&&t.onrender()}},n.src=r}}(i,n),t.onrender&&t.onrender()}},"undefined"!=typeof module&&module.exports?module.exports=e:"undefined"!=typeof define&&define.amd?define([],function(){return e}):window.QRCode=e}();
    </script>
    <script>
    !function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=t()}}(function(){return function t(e,r,i){function n(s,c){if(!r[s]){if(!e[s]){var f="function"==typeof require&&require;if(!c&&f)return f(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=r[s]={exports:{}};e[s][0].call(u.exports,function(t){var r=e[s][1][t];return n(r||t)},u,u.exports,t,e,r,i)}return r[s].exports}for(var a="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(t,e,r){"use strict";var i=t("./utils"),n=t("./support"),a=null;a=n.uint8array?function(t){return t.subarray(0)}:function(t){return t.slice(0)},e.exports=function(t){var e=this;t=t||{},i.extend(e,t),e.stream=e.stream||function(t,r){e.on("data",function(t,e){r(null,t,e)}),e.on("error",function(t){r(t,null)}),e.on("end",function(){r(null,null)})},e.on=e.on||function(){},e.pause=e.pause||function(){},e.resume=e.resume||function(){},e.readable=e.readable||e.stream,e.writable=e.writable||e.stream,e.ended=!1,e._keys=[],e.data=null,e._buffer="",e._size=0,e._length=0,e._isBuffer=n.uint8array,e._isStream=e.readable&&"function"==typeof e.readable.on,e.on("data",function(t){e._length+=t.length;var r,i,n=e._size>0?e._size:null;if(null!==e.data)e._isBuffer?e._isStream&&null===n?(e.data=null,e._buffer+=e._isBuffer?this.data:t):null===n?(r=new Uint8Array(e.data.length+t.length),r.set(e.data,0),r.set(t,e.data.length),e.data=r):t.length+e._buffer.length>n?e.data=null:e.data.set(t,e._buffer.length):e.data+=t;else{if(e._isBuffer&&e._isStream&&null===n)return void(e._buffer+=t);if(null===n)e._buffer+=t;else{if(e._buffer.length+t.length>n)return void(e._buffer=e._buffer.substring(0,n));e._buffer+=t}}e._size=null,i=e.getBuffer(e._length),e.data=i.data,e._buffer=i.meta.rest,e._size=i.meta.size,e._keys=i.meta.keys})},e.exports.prototype={getBuffer:function(t){for(var e,r="",i=[],n=this._buffer,a=n.length,s=0;s<a&&(e=this.read(t),-1!==e);)i.push(e),t=this.stream?null:n.length-s,s+=n.length-(n=this._buffer).length;return n.length>0&&(r=n),{data:this._isBuffer?a(i):i,meta:{keys:this._keys,rest:r,size:this._size}}}},{2:[function(t,e,r){"use strict";function i(){}var n=t("./stream/GenericStream");i.prototype.magic="PK",i.prototype.check=function(t){var e=t.readString(4);e!==this.magic&&(t.recoverable=!0,t.error=new Error("Invalid zip file.")),t.offset=4},i.prototype.decode=function(){},i.prototype.encode=function(){return n.prototype.magic},e.exports=i},{}],3:[function(t,e,r){"use strict";function i(t,e){this.options=t,this.stream=e}var n=t("readable-stream").Transform,a=t("util");a.inherits(i,n),i.prototype._transform=function(t,e,r){var i,n=t.length,a=this.stream;for(this.stream.paused&&(i=this.stream.read());i;)n+=i.length,i=this.stream.read();this.push(t),r()},e.exports=i},{util:11}],4:[function(t,e,r){"use strict";var i=t("../utils"),n=t("../stream/GenericStream"),a=t("../utf8"),s=function(t,e){var r,s,c,f,l,u,p,h=e,d=function(t){var e=t.charCodeAt(0);return e<128?String.fromCharCode(e):String.fromCharCode(128|63&e)};if(h&&"string"!=typeof h){if(s=(u=h).length,c=new Array(s),1===u.BYTES_PER_ELEMENT&&"function"==typeof u.subarray){for(l=u.subarray(0,s),r=0;r<s;r++)c[r]=d(l[r]);return c.join("")}for(r=0;r<s;r++)c[r]=d(u[r]);return c.join("")}if("string"==typeof h){s=(f=h).length,c=new Array(s);for(r=0;r<s;r++)c[r]=255&f.charCodeAt(r);return(p=new i.Buf(s)).set(c,0),p}},o=function(t,e,r){var s,c,f,l,u=r,p=function(t){for(var e=t.length;e>0&&255===t.charCodeAt(e-1);)e--;return t.substring(0,e)},h=function(t){var e,r,i=t.length,n=new Array(i);for(e=0;e<i;e++)r=t.charCodeAt(e),n[e]=255&r;return n};if(u&&"string"!=typeof u){if(2===u.BYTES_PER_ELEMENT)return p(String.fromCharCode.apply(null,new Uint16Array(u.buffer)));if(1===u.BYTES_PER_ELEMENT){if("function"==typeof u.subarray)return s=u.subarray(0,u.length),p(String.fromCharCode.apply(null,s));c=new Array(u.length);for(f=0;f<u.length;f++)c[f]=u[f];return p(String.fromCharCode.apply(null,c))}}if("string"==typeof u)return u;"undefined"!=typeof Uint8Array?l=new Uint8Array(e.length):l=h(e),i.arraySet(l,e.split(""),0)},c=function(t){return a.utf8encode(t)},f=function(t){return a.utf8decode(t)};function l(){n.call(this,"Nodejs stream")}t("../utils").inherits(l,n),l.prototype.on=function(t,e){"data"===t?this.chunks.push(e):this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},l.prototype.pause=function(){return this.paused=!0,this},l.prototype.resume=function(){return this.paused=!1,this.emit("drain"),this},l.prototype.write=function(t){var e=this;if(this.ended)return!1;this.paused&&this.once("drain",function(){e.write(t)});var r,n=t.length;for(r=0;r<n;r++)this.chunks.push(t[r]);return this.emit("data",t),!0},l.prototype.end=function(){this.ended=!0,this.emit("end")},l.prototype.read=function(){return this.chunks.length>0?this.chunks.shift():null},l.prototype.pipe=function(t){this.on("data",function(e){t.write(e)}),this.on("end",function(){t.end()})},e.exports=function(t,r,i){var n,a=t;switch(r){case"blob":try{return n=new Blob([a],{type:"application/zip"}),Promise.resolve(n)}catch(t){try{var u=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder;return(n=new u).append(a),Promise.resolve(n.getBlob("application/zip"))}catch(t){return Promise.reject(new Error("Blob type is not supported on this platform."))}}break;case"base64":return Promise.resolve(s(a));case"binarystring":return Promise.resolve(o(a,i));case"array":return Promise.resolve(a.split("").map(function(t){return t.charCodeAt(0)}));case"uint8array":return Promise.resolve(new Uint8Array(a.split("").map(function(t){return t.charCodeAt(0)})));case"arraybuffer":return Promise.resolve((new Uint8Array(a.split("").map(function(t){return t.charCodeAt(0)}))).buffer);case"string":return Promise.resolve(c(f(a)));case"nodebuffer":var p=new Buffer(a.length);return a.split("").forEach(function(t,e){p[e]=t.charCodeAt(0)}),Promise.resolve(p);default:return Promise.reject(new Error("The output type "+r+" is not supported."))}return Promise.reject(new Error("The output type "+r+" is not supported."))}},{"../stream/GenericStream":29,"../utf8":33,"../utils":34,util:11}],5:[function(t,e,r){"use strict";function i(t,e){var r,i=t.length;for(e||(e=new n("undefined"!=typeof Uint8Array?new Uint8Array(i):new Array(i),i)),r=0;r<i;r++)e[r]=255&t.charCodeAt(r);return e}var n=t("./utils").Buf;e.exports=i},{}],6:[function(t,e,r){"use strict";var i=t("./stream/StreamHelper"),n=t("./utf8");e.exports=function(t,e){var r="",a=t.length,s=0;try{for(;s<a;)r+=String.fromCharCode.apply(null,i.getBuffer(t,e,s,1024)),s+=1024}catch(i){for(;s<a;)r+=String.fromCharCode(t[s++])}return n.utf8decode(r)}},{utf8:12}],7:[function(t,e,r){"use strict";var i=t("./compressions"),n=t("./crc32");e.exports=function(t,e){var r,a,s,c,f,l=0,u=[],p="",h=0,d=i[e.compression].uncompress,g=function(t){var e,r,i=[],n=t.length;for(e=0;e<n;e++)i.push(255&t.charCodeAt(e));return i};for(f in this.files)this.files[f].comment=this.files[f].comment||"";if(this.comment)for(p=n(this.comment),h=this.comment.length,l=0;l<h;l++)u.push(255&this.comment.charCodeAt(l));var v,m,w,b,y,_,k;for(f in this.files)v=this.files[f],w=(m=new Date(v.date)).getUTCFullYear(),b=m.getUTCMonth()+1,y=m.getUTCDate(),_=m.getUTCHours(),k=m.getUTCMinutes(),s=v.name,a=(n(s),s.length),u.push(80,75,1,2,v.version,0,10,0,v.options.compression?8:0,0,k<<5|_>>3,y<<5|b,w-1980>>1,c=n(v.asNodeBuffer()),u.push(255&c,c>>8&255,c>>16&255,c>>24&255),u.push(255&v.compressedSize,v.compressedSize>>8&255,v.compressedSize>>16&255,v.compressedSize>>24&255),u.push(255&v.uncompressedSize,v.uncompressedSize>>8&255,v.uncompressedSize>>16&255,v.uncompressedSize>>24&255),u.push(255&a,a>>8&255),u.push(0,0),u.push(0,0),u.push(0,0),u.push(32,0,0,0),u.push(255&v.offset,v.offset>>8&255,v.offset>>16&255,v.offset>>24&255),l+=46;for(l+=a,r=0;r<a;r++)u.push(255&s.charCodeAt(r));for(f in this.files)l+=this.files[f].compressedSize;return u.push(80,75,5,6,0,0,0,0),u.push(255&Object.keys(this.files).length,Object.keys(this.files).length>>8&255),u.push(255&Object.keys(this.files).length,Object.keys(this.files).length>>8&255),u.push(255&l,l>>8&255,l>>16&255,l>>24&255),u.push(255&h,h>>8&255),l+=22,String.fromCharCode.apply(null,u)}},{compressions:8,crc32:9}],8:[function(t,e,r){"use strict";r.STORE={magic:String.fromCharCode(0,0),compress:function(t){return t},uncompress:function(t){return t}},r.DEFLATE={magic:String.fromCharCode(8,0),compress:function(e,r){return t("pako").deflate(e,{raw:!0,level:r.level})},uncompress:function(e){return t("pako").inflate(e,{raw:!0})}}},{pako:13}],9:[function(t,e,r){"use strict";var i=[];!function(){for(var t,e=0;e<256;e++){t=e;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;i[e]=t}}(),e.exports=function(t,e){e||(e=0);for(var r=~~e,n=0,a=t.length;n<a;n++)r=i[255&(r^t.charCodeAt(n))]^r>>>8;return r}},{}],10:[function(t,e,r){"use strict";function i(t){return"undefined"==typeof t||null===t?new n.InvalidDateError:new n.InvalidDateError(t) instanceof n.InvalidDateError?t:new Date(t)}var n=t("./errors");e.exports={load:function(t,e,r){try{if("string"==typeof e)return Promise.resolve(this.utf8decode(e));if("blob"==typeof e)return this.loadBlob(e);if(e instanceof ArrayBuffer)return this.loadArrayBuffer(e);if("uint8array"==typeof e.constructor.name.toLowerCase()&&"function"==typeof e.subarray)return this.loadUint8Array(e);if("nodebuffer"===r)return this.loadNodeBuffer(e)}catch(t){return Promise.reject(t)}},loadBlob:function(t){var e=this;return new Promise(function(r,i){var n=new FileReader;n.onload=function(i){var n=i.target.result;r(e.loadArrayBuffer(n))},n.onerror=function(t){i(t)},n.readAsArrayBuffer(t)})},loadUint8Array:function(t){return this.loadArrayBuffer(t.buffer)},loadNodeBuffer:function(t){return this.loadArrayBuffer(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength))},loadArrayBuffer:function(t){var e=this;return new Promise(function(r,i){var n;try{n=e.load(t)}catch(t){return void i(t)}r(n)})}}},{}],11:[function(t,e,r){var i,n=t("buffer"),a=n.Buffer,s=t("util"),o=t("stream");function c(){}function f(t,e,r){this.chunk=t,this.encoding=e,this.callback=r}function l(){}function u(t,e){this.options=e=e||{},e.highWaterMark=e.highWaterMark||16384,"number"!=typeof e.highWaterMark||e.highWaterMark<0?this.highWaterMark={obj:16,notObj:16384}:this.highWaterMark={obj:e.highWaterMark,notObj:e.highWaterMark},this.highWaterMark.notObj=~~this.highWaterMark.notObj,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!e.objectMode,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=0,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder?this.decoder.end():this.decoder=new(t("string_decoder").StringDecoder)(e.encoding),this.encoding=e.encoding)}function p(t){return this instanceof p?(this._readableState=new u(t,this),this.readable=!0,void o.call(this)):new p(t)}function h(t,e){this.objectMode=!!(e=e||{}).objectMode,e.highWaterMark=e.highWaterMark||16384,"number"!=typeof e.highWaterMark||e.highWaterMark<0?this.highWaterMark={obj:16,notObj:16384}:this.highWaterMark={obj:e.highWaterMark,notObj:e.highWaterMark},this.highWaterMark.notObj=~~this.highWaterMark.notObj,this.writable=!0,this.writecb=null,this.writelen=0,this.writing=!1,this.length=0,this.buffer=[],this.ended=!1,this.flowing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){return function(e){var r=this._writeableState,i=r.sync,n=r.writecb;if(r.writing=!1,r.writecb=null,r.writelen=0,e)i?setTimeout(function(){n(e)},0):n(e),this.emit("error",e);else{var a=this.buffer.shift();a&&(r.bufferProcessing=!0,this._write(a.chunk,a.encoding,a.callback),r.bufferProcessing=!1),i?setTimeout(function(){var t=r.buffer.length>0;t&&this.emit("drain")}.bind(this),0):this.emit("drain")}}}.call(this,t),this._writeableState=this,o.call(this)}function d(t){return this instanceof d?(this._readableState=new u(t,this),this._writeableState=new h(t,this),this.readable=!0,this.writable=!0,this.allowHalfOpen=!0,t&&"function"==typeof t.readable&&t.readable===!1?this.readable=!1:t&&"function"==typeof t.writable&&t.writable===!1&&(this.writable=!1),o.call(this)):new d(t)}function g(t){return this instanceof g?(h.call(this,t),o.call(this)):new g(t)}r.inherits=t("inherits"),r.isBuffer=function(t){return t instanceof n.Buffer},r.isDate=function(t){return"[object Date]"===Object.prototype.toString.call(t)},r.isError=function(t){return"[object Error]"===Object.prototype.toString.call(t)||t instanceof Error},r.isArray=Array.isArray,r.isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},r.isObject=function(t){return"object"==typeof t&&null!==t},r.isFunction=function(t){return"function"==typeof t},r.isString=function(t){return"string"==typeof t},r.isNumber=function(t){return"number"==typeof t},r.isUndefined=function(t){return void 0===t},r.isNull=function(t){return null===t},r.isNullOrUndefined=function(t){return null==t},r.log=function(){console.log("%s - %s",new Date,s.format.apply(s,arguments))},r.inspect=s.inspect,r.pump=null,s.inherits(p,o),p.prototype.push=function(t,e){var r=this._readableState;return r.objectMode||"string"!=typeof t||(e=e||r.defaultEncoding,e!==r.encoding&&(t=new n.Buffer(t,e),e="buffer")),"object"==typeof t&&!(t instanceof n.Buffer)&&!r.objectMode?r.flowing=!1:null===t?r.ended=!0:(r.buffer.push(t),r.length+=r.objectMode?1:t.length),r.ended?m(this):w(this),r.length<r.highWaterMark.notObj},p.prototype.unshift=function(t){var e=this._readableState;return e.objectMode||"string"!=typeof t||(t=new n.Buffer(t,e.encoding)),null===t?e.ended=!0:e.buffer.unshift(t),e.ended?m(this):w(this),e.length<e.highWaterMark.notObj},p.prototype.setEncoding=function(e){var r=new(t("string_decoder").StringDecoder)(e);return this._readableState.decoder=r,this._readableState.encoding=e,this},p.prototype.read=function(t){var e=this._readableState,r=e.buffer,i=e.length,s=e.ended,o=e.flowing,c=e.sync;if(s)return null===i?null:0;if(!o&&this.emit("readable"),!i)return null;var f=e.highWaterMark.notObj,l=e.objectMode,u=l?1:t;if(u>f&&(u=f),0<t&&t<u&&(u=t),0===u)return null;if(l&&0===r.length)return null;if(0===r.length)return null;var p=new n.Buffer(u),h=l?function(t,e,r){return e.shift()}(0,r,p):function(t,e,r){var i=0;e.length>=t?(i=t,n.Buffer.prototype.copy.call(e[0],r,0,0,i),e[0].length-i>0?e[0]=e[0].slice(i,e[0].length):(e[0]=null,e.shift())):(i=e[0].length,n.Buffer.prototype.copy.call(e[0],r,0,0,i),e[0]=null,e.shift());return i}(u,r,p);return h.length&&(e.length-=h.length),!l&&0===e.length&&0===r.length&&e.ended&&(e.ended=!1,this.emit("end")),h},p.prototype.on=function(t,e){var r=o.prototype.on.call(this,t,e);return"data"===t&&!1===this._readableState.flowing&&this.resume(),"readable"===t&&this._readableState.readableListening||(this._readableState.readableListening=!0,this._readableState.emittedReadable=!1,this._readableState.needReadable=!0,this._readableState.reading||setTimeout(function(){this._read(this._readableState.highWaterMark.notObj)}.bind(this),0)),r},p.prototype.addListener=p.prototype.on,p.prototype.resume=function(){var t=this._readableState;return t.flowing||(t.flowing=!0,function(t,e){for(e.reading=!0;e.needReadable&&!e.ended&&e.length<e.highWaterMark.notObj&&!e.readingMore;)e.readingMore=!0,e.ranOut=e.length,t._read(e.highWaterMark.notObj),e.readingMore=!1;e.reading=!1;e.ranOut=0}(this,t)),this},p.prototype.pause=function(){return!1!==this._readableState.flowing&&(this._readableState.flowing=!1,this.emit("pause")),this},p.prototype.wrap=function(t){var e=this._readableState,r=!1;for(var i in t.on("end",function(){if(e.ended)return;e.ended=!0,this.readable&&this.emit("end")}.bind(this)),t.on("data",function(i){e.objectMode||(i=new n.Buffer(i)),e.ended||this.push(i),r||(r=!0,e.reading||(e.reading=!0,this.resume()))}.bind(this)),t)void 0===this[i]&&"function"==typeof t[i]&&(this[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));return this},p.prototype._read=function(t){this.emit("error",new Error("not implemented"))},s.inherits(h,o),h.prototype.write=function(t,e,r){var i=this._writeableState,s=!1;return"function"==typeof e&&(r=e,e=null),t instanceof n.Buffer?e="buffer":e||(e=i.defaultEncoding),"function"!=typeof r&&(r=c),i.ended?function(t,e){var r=new Error("write after end");t.emit("error",r),setTimeout(function(){e(r)},0)}(this,r):i.buffer.length<i.highWaterMark.notObj&&(s=!0),s?(i.bufferProcessing||this._write(t,e,r),i.writing=!0,i.sync=!1,i.writelen=t.length,i.writecb=r,s):(i.buffer.push(new f(t,e,r)),i.length+=i.objectMode?1:t.length,s)},h.prototype._write=function(t,e,r){r(new Error("not implemented"))},s.inherits(d,p),d.prototype.end=function(t,e,r){"function"==typeof t?(r=t,t=null,e=null):"function"==typeof e&&(r=e,e=null),void 0!==t&&null!==t&&this.write(t,e),this.writable&&this.write(""),this.end=function(){},r&&this.on("finish",r),this.readable||this.emit("end")},d.prototype.destroy=function(){this.readable=!1,this.writable=!1,this.emit("close")},s.inherits(g,h),g.prototype.end=function(t,e,r){"function"==typeof t?(r=t,t=null,e=null):"function"==typeof e&&(r=e,e=null),this.write(t,e),this.end=function(){},r&&this.on("finish",r)},e.exports.Readable=p,e.exports.Writable=h,e.exports.Duplex=d,e.exports.Transform=g,e.exports.PassThrough=function(t){return this instanceof arguments.callee?(g.call(this,t),o.call(this)):new arguments.callee(t)},s.inherits(e.exports.PassThrough,g),e.exports.PassThrough.prototype._transform=function(t,e,r){r(null,t)},e.exports.Stream=o,o.prototype.pipe=function(t,e){var r=this;function i(e){t.writable&&!1===t.write(e)&&r.pause()}function n(){r.readable&&r.resume()}t.on("unpipe",function e(i){i===r&&(r.removeListener("data",i),t.removeListener("drain",n),t.removeListener("unpipe",e))}),t.on("drain",n),r.on("data",i),r.on("end",function(){t.end()}),t.emit("pipe",r)},e.exports.super_=s;var v=function(t){t.Readable=p,t.Writable=h,t.Duplex=d,t.Transform=g,t.PassThrough=e.exports.PassThrough,t.Stream=o},m=function(t){t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,setTimeout(function(){this.emit("readable")}.bind(t),0))},w=function(t){t.needReadable=!0,t.emittedReadable=!1,t.reading||setTimeout(function(){this._read(t.highWaterMark.notObj)}.bind(t),0)}},{buffer:2,inherits:12,"string_decoder":10,util:14}],12:[function(t,e,r){var i,n=t("buffer"),a=n.Buffer;function s(t,e){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r]);return e}"function"==typeof a.isBuffer?i=a.isBuffer:i=function(t){return t instanceof a},r.isBuffer=i,r.isArray=Array.isArray,r.isDate=function(t){return"[object Date]"===Object.prototype.toString.call(t)},r.isError=function(t){return"[object Error]"===Object.prototype.toString.call(t)||t instanceof Error},r.isFunction=function(t){return"function"==typeof t},r.isObject=function(t){return t&&"object"==typeof t},r.isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},r.isString=function(t){return"string"==typeof t},r.isNumber=function(t){return"number"==typeof t},r.isNull=function(t){return null===t},r.isUndefined=function(t){return void 0===t},r.isNullOrUndefined=function(t){return null==t},r.inherits=t("inherits"),r.inspect=t("util").inspect,r.log=function(){console.log("%s - %s",(new Date).toUTCString(),t("util").format.apply(this,arguments))},r._extend=s},{buffer:2,inherits:12,util:14}],13:[function(t,e,r){var i=t("zlib");e.exports=i},{zlib:15}],14:[function(t,e,r){e.exports=t("util")},{util:11}],15:[function(t,e,r){"use strict";var i={};!function(t){t.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}}return t},t.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):t.slice(0,e)}}("object"==typeof r?r:this);var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function a(t,e){return Object.prototype.hasOwnProperty.call(t,e)}r.assign=i.assign,r.shrinkBuf=i.shrinkBuf;var s="undefined"!=typeof Uint8Array?new Uint8Array(0):[],o=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],c=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],l=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],u=new Array(576);!function(){for(var t=0;t<288;t++)switch(!0){case t>=0&&t<=143:u[t]=(48+t<<8)+8;break;case t>=144&&t<=255:u[t]=(256+t-144<<8)+9;break;case t>=256&&t<=279:u[t]=(0+t-256<<8)+7;break;case t>=280&&t<=287:u[t]=(192+t-280<<8)+8}}();var p=new Array(60);!function(){for(var t=0;t<30;t++)switch(!0){case t>=0&&t<=29:p[t]=(t<<10)+5}}();function h(t,e,r,i,n){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=i,this.max_length=n}var d,g;function v(t,e,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=i}var m=[new v(0,0,0,0),new v(4,4,8,4),new v(4,5,16,8),new v(4,6,32,32),new v(4,4,16,16),new v(8,16,32,32),new v(8,16,128,128),new v(8,32,128,256),new v(32,128,258,1024),new v(32,258,258,4096)];function w(t){var e;for(this.options=t||{},e=this.options,this.next_in_index=0,this.next_out_index=0,this.avail_in=0,this.avail_out=0,this.total_in=0,this.total_out=0,this.dstate=null,this.istate=null,this.wbits=e.windowBits||15,this.wsize=1<<this.wbits,this.whave=0,this.wnext=0,this.write=0,this.pending_buf_size=0,this.pending_buf=null,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=0,this.status=0,this.pending_out=0,this.pending=0,this.strm=null,this.adler=0,this.msg="",this.data_type=0,this.zfree=null,this.zalloc=null,this.opaque=null,this.strategy=e.strategy||0,this.level=e.level||-1,this.noheader=!e.raw,this.wbits>0?this.wbits=-this.wbits:e.gzip?(this.wbits+=16,this.gzhead=new function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name=null,this.comment=null,this.hcrc=0,this.done=!1}):e.raw&&(this.wbits=null),this.memLevel=e.memLevel||8,this.dstate=new b(this),n&&!e.raw&&(this.pending_buf_size=2*this.wsize,this.pending_buf=new Uint8Array(this.pending_buf_size)),this.istate=new y(this)}function b(t){var e;for(this.strm=t,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=0,this.last_flush= -1,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0,this.strm.options.windowBits=this.strm.options.windowBits,this.wbits=this.strm.options.windowBits,this.wsize=1<<this.wbits,this.whave=0,this.wnext=0,this.write=0,this.window_size=1<<this.wbits,n?this.window=new Uint8Array(this.window_size):this.window=new Array(this.window_size),this.pending_buf_size=2*this.wsize,this.pending_buf=new Uint8Array(this.pending_buf_size),this.distcode=new Int32Array(512),this.lencode=new Int32Array(852),this.next=new Int32Array(1<<this.wbits),this.lens=new Uint16Array(320),e=0;e<320;e++)this.lens[e]=0;for(e=0;e<288;e++)this.work[e]=0;for(e=0;e<512;e++)this.distcode[e]=0;for(e=0;e<852;e++)this.lencode[e]=0;for(e=0;e<1<<this.wbits;e++)this.next[e]=0}function y(t){this.strm=t,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),this.l_buf=0,this.lit_bufsize=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.strm.options.windowBits=this.strm.options.windowBits,this.wbits=this.strm.options.windowBits,this.wsize=1<<this.wbits,this.wmask=this.wsize-1,this.hash_bits=this.strm.options.memLevel+7,this.hash_size=1<<this.hash_bits,this.hash_mask=this.hash_size-1,this.hash_shift=~~((this.hash_bits+3-1)/3),this.window=new Uint8Array(2*this.wsize),this.head=new Uint16Array(this.hash_size),this.prev=new Uint16Array(this.wsize),this.lit_bufsize=1<<this.strm.options.memLevel+6,this.pending_buf_size=4*this.lit_bufsize,this.pending_buf=new Uint8Array(this.pending_buf_size),this.d_buf=this.pending_buf_size/2,this.l_buf=this.d_buf+1,this.level=this.strm.options.level,this.strategy=this.strm.options.strategy,this.good_match=m[this.level].good_length,this.nice_match=m[this.level].nice_length,this.max_chain_length=m[this.level].max_chain,this.max_lazy_match=m[this.level].max_lazy,this.l_desc=new h(this.dyn_ltree,o,257,286,15),this.d_desc=new h(this.dyn_dtree,c,0,30,15),this.bl_desc=new h(this.bl_tree,f,0,19,7)}function _(t,e,r,i){var n=t.heap[i],a=i<<1;for(;a<=t.heap_len&&(a<t.heap_len&&t.depth[t.heap[a+1]]<t.depth[t.heap[a]]&&a++,!(t.depth[n]>t.depth[t.heap[a]]));)t.heap[i]=t.heap[a],i=a,a<<=1;t.heap[i]=n}function k(t,e,r){var i,n,a,s,c=0;if(0!==t.last_flush)t.last_flush=-1;else if(t.avail_in>0||t.avail_out>0)return 1;if(t.pending>0){if(t.strm.avail_out>0){var f=t.strm.next_out,l=t.strm.next_out_index,u=t.strm.avail_out,p=t.pending_out,h=t.pending_out+t.pending>u?u:t.pending;if(n=h,i=t.pending_buf,a=p,s=f,c=l,n>0)if(i.subarray)i.subarray(a,a+n).set(s.subarray(c,c+n));else for(var d=0;d<n;d++)s[c+d]=i[a+d];t.strm.next_out_index+=h,t.strm.total_out+=h,t.strm.avail_out-=h,t.pending_out+=h,t.pending-=h,0===t.pending&&(t.pending_out=0)}return t.pending>0?1:0}return 0===t.last_flush?1:0}function z(t){var e,r,i,n,a,o=t.dyn_ltree,s=t.dyn_dtree,c=t.bl_tree,f=t.l_desc.static_tree,l=t.d_desc.static_tree,p=t.bl_desc.static_tree,h=t.strstart,d=t.block_start,g=t.lookahead,v=0;for(e=0;e<=285;e++)o[2*e]=0;for(e=0;e<=29;e++)s[2*e]=0;for(e=0;e<=18;e++)c[2*e]=0;for(o[512]=1,e=0;e<t.opt_len;e++)a=t.pending_buf[t.d_buf+2*e],n=t.pending_buf[t.d_buf+2*e+1],o[2*n]++,0!==a&&(v++,o[2*(257+a-3)]++,s[2*function(t){return t<256?p[t]:p[256+(t>>7)]}(n)]++);if(t.opt_len<t.static_len){for(r=0,i=h;i<h+t.opt_len;i++)o[2*t.window[i]]++,v++;o[512]++,t.matches=0}else{for(e=0;e<=143;e++)f[2*e]&&o[2*e]++;for(e=0;e<=29;e++)l[2*e]&&s[2*e]++;for(r=0,i=h;i<h+t.static_len;i++)o[2*t.window[i]]++,v++;o[512]++,t.matches=0}for(t.l_desc.max_code=r>v?r:v,t.d_desc.max_code=0,t.bl_desc.max_code=0,e=0;e<19;e++)p[2*e]&&c[2*e]++}function S(t,e){var r,i,n,a=e.dyn_tree,o=e.max_code,s=e.static_tree,c=e.max_length,f=e.extra_base,l=e.extra_bits,u=e.elems,p=0,h=0;for(r=0;r<=c;r++)t.bl_count[r]=0;for(i=0;i<u;i++)n=a[2*i+1],0!==n?(t.bl_count[n]++,t.pending_buf[t.d_buf+2*p++]=i,n>c&&(h=n)):t.bl_count[0]++;for(e.max_code=p,r=1;r<=c;r++)t.bl_count[r]+=t.bl_count[r-1];var d=0;for(r=1;r<=c;r++)d=d+t.bl_count[r]<<1,d>t.heap_max&&(d=t.heap_max);for(i=0;i<u;i++){var g=a[2*i+1];0!==g&&(t.heap[t.heap_len++]=i,t.depth[i]=g)}for(i=t.heap_len>>1;i>=1;i--);for(i=t.heap_len-1;i>=2;i--){var v=t.heap[1];t.heap[1]=t.heap[i],t.heap[i]=v,_(t,0,0,1)}for(i=t.heap_len-1;i>=2;i--){v=t.heap[1],t.heap[1]=t.heap[i],t.heap[i]=v,_(t,0,0,1),o=t.heap[1],n=t.depth[o],r=t.heap[1]=i-1,d=t.heap[i-1],t.depth[d]>n+1&&(t.depth[d]=n+1,t.bl_count[n+1]++)}for(i=0;i<u;i++){var m=a[2*i+1];0!==m&&(t.depth[i]>c&&(t.depth[i]=c,t.bl_count[c]++),a[2*i+1]=t.depth[i])}var w=0;for(r=c;r>=1;r--){var b=t.bl_count[r];if(0!==b)do{var y=t.heap[--t.heap_len];t.depth[y]!==r&&(w=1,y>o?o=y:y>o||(t.heap[t.heap_len]=y))}while(t.depth[y]=r,0!==--b)}if(w)do{t.bl_count[c]--;for(r=c-1;0!==t.bl_count[r]&&r>=1;r--)t.bl_count[r]--,t.bl_count[r+1]+=2}while(0===t.bl_count[c]);for(i=0;i<u;i++)a[2*i+1]=t.depth[i]}function x(t,e,r){var i,n,a,s,c,f,l= -1,u=e.length,p=0,h=7,d=4;for(0===u?p=140:110===u&&t.lit_bufsize>0?p=141:(t.lit_bufsize-u<258&&t.lit_bufsize>258?p=42:u<258?p=142:u>258&&(p=143),i=0,n=u,a=new Uint16Array(u),s=new Uint16Array(u);n>0;){var g=16384,v=t.window_size-t.wsize-t.lookahead,m=Math.min(t.wsize-t.lookahead-1,n),w=Math.min(m,t.max_chain_length);if(0===t.strstart&&0===t.lookahead&&(t.strstart=1,v++),v>t.wsize)return-1;if(g>t.wsize-t.lookahead&&g>n&&(g=n),t.window.set(e.subarray(i,i+g),t.strstart+t.lookahead),t.lookahead+=g,function(t){for(var e=t.ins_h,r=t.strstart+t.lookahead-3;t.strstart+t.lookahead-t.wsize<0&&r>0;){e=((e<<t.hash_shift^t.window[r])&t.hash_mask,t.prev[r&t.wmask]=t.head[e],t.head[e]=r,r--);for(;(e=((e<<t.hash_shift^t.window[r])&t.hash_mask,t.prev[r&t.wmask]=t.head[e],t.head[e]=r,r--))>=t.strstart-t.wsize&&r>0;);t.ins_h=e}}(t),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,t.strstart>=t.wsize-257&&(t.window.set(t.window.subarray(t.wsize,2*t.wsize),0),t.match_start-=t.wsize,t.strstart-=t.wsize,t.block_start-=t.wsize,v=t.head.length,c=0;c<v;c++)f=t.head[c],t.head[c]=f>=t.wsize?f-t.wsize:0;for(v=t.prev.length,c=0;c<v;c++)f=t.prev[c],t.prev[c]=f>=t.wsize?f-t.wsize:0;i+=g,n-=g,t.block_start+=g;var b=0;if(t.lookahead>=3){e=t.strstart-1,r=t.strstart;var y=t.window[r]+256,A=t.window[r+1]+256,C=t.window[r+2]+256;do{if(t.ins_h=((t.ins_h<<t.hash_shift^t.window[r+3-1])&t.hash_mask),t.hash=t.head[t.ins_h],t.prev[r&t.wmask]=t.head[t.ins_h],t.head[t.ins_h]=r,t.strstart+t.match_length<=t.strstart+t.lookahead)for(var E=function(t,e,r,i){var n,a,s,c,f=t.prev,l=t.strstart,u=t.window,p=t.max_chain_length,h=t.max_lazy_match,d=t.nice_match,g=t.wsize,v=t.strstart+258,m=0;for(s=0;s<p&&void 0!==(n=i);s++){if(a=f[n&t.wmask],u[l+m]===u[a+m]&&u[l+m-1]===u[a+m-1]&&u[l]===u[a]&&u[++l]===u[++a]&&u[++l]===u[++a]&&u[++l]===u[++a]&&u[++l]===u[++a]&&u[++l]===u[++a]){if(m+=8,l=t.strstart+m,a=t.prev[n&t.wmask],u[l-1]===u[a-1]&&u[l]===u[a])for(;++l!==v&&u[l]===u[a];)l++,a++;return m=258,t.match_start=n,m}if(m<h&&(c=l-t.strstart+a-t.strstart,c<d&&(m=c,t.match_start=n)),m>=h)break}return m}(t,0,0,t.hash),T=0;T<E&&r+T<t.strstart+t.lookahead;T++);r++,t.lookahead--}while(t.lookahead>0)}else t.lookahead=0,r=t.strstart,e=t.strstart-1;return t.strstart+=t.lookahead,t.lookahead=0,l>=0?a[l++]=257:a[l=0]=257,s[l-1]=t.strstart-1-e,t.insert=e-t.strstart,b?(t.lookahead>0&&(t.match_available=1),t.strm.avail_in>0):void 0}}var C=[8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8],E=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67];function T(t,e,r,i,n){this.list=t,this.max_length=e,this.max_code=r,this.length=i,this.table=n}function A(t,e,r){var i,n,a,s,c,f,l,u,p,h,d,g,v,m,w,b,y,_,k,z,S,x,C;for(i=0,n=0;n<e.length;n++)i=e[n]>i?e[n]:i;for(a=new Uint16Array(i+1),s=new Uint16Array(i+1),c=0;c<e.length;c++)a[e[c]]++;var E=0;for(a[0]=0,f=1;f<=i;f++)E=E+a[f-1]<<1,s[f]=E;for(l=new Uint16Array(e.length),u=0;u<e.length;u++)0!==e[u]&&(l[u]=s[e[u]]++);for(C=new T(null,0,0,0,null),C.max_length=i,C.list=new Int32Array(r),p=0;p<r;p++)C.list[p]=0;for(p=0;p<e.length;p++)if(0!==e[p]){for(d=l[p],v=e[p],m=d,w=v-1,b=0,y=1<<w,x=y>>1;_=(m&y-1)+x,S=C.list[_];S>0;){if((S&y-1)<_)break;S=C.list[y-1&S]}if(0===S)for(C.list[_]=d<<4|v,z=C.list.length;_>z;)z=2*z,C.list=function(t,e){for(var r=new Int32Array(e),i=0;i<t.length;i++)r[i]=t[i];return r}(C.list,z);else{for(k=S>>>4,S&=y-1,C.list[_]=S;S<C.max_code;){if(g=k&y-1,m=l[g],b=e[g],v=b-w,v>0&&(y=1<<v,w+=v),y<y&&(y= -y),k=C.list[g+x],v+w>i&&v+w>i){C.list[y-1&S]=d<<4|v,w+=v;break}if(v+w<=i)for(C.list[y-1&S]=k<<4|v,z=C.list.length;S>z;)z=2*z,C.list=function(t,e){for(var r=new Int32Array(e),i=0;i<t.length;i++)r[i]=t[i];return r}(C.list,z);else{for(S=C.list[y-1&S],w-=v,y=1<<w,z=C.list.length;S>z;)z=2*z,C.list=function(t,e){for(var r=new Int32Array(e),i=0;i<t.length;i++)r[i]=t[i];return r}(C.list,z);if(S>=0&&C.list[y-1&S]>0)break;C.list[y-1&S]=k<<4|v}}}}}var N=/[\x00-\x1f\x7f-\x9f]/;function O(t,e){var r,i,n,s,c,f,l,u,p,h,d,g;if(t&&t.state?(s=t.state,i=t.next_out,r=t.next_in,c=t.avail_in,f=t.avail_out,n=s.strm.next_out_index,l=s.strm.avail_out,u=s.hold,p=s.bits,h=s.strm.next_in_index,d=s.strm.avail_in,g=s.write):0,s.wrap=1,s.wbits=s.strm.options.windowBits||15,s.strm.adler=1,s.strm.adler=function t(e,r,i,n){for(var a=65535&e,s=e>>>16,c=0;i>0;){c=i>3800?3800:i;i-=c;do{a+=r[n++],s+=a}while(--c);a%=65521,s%=65521}return a|s<<16}(s.strm.adler,s.strm.input,s.strm.avail_in,s.strm.next_in_index),t.next_in_index=s.strm.avail_in,t.total_in=s.strm.total_in,s.strm.avail_in=0,s.last_flush=e,s.ended?0:1){s.strm.next_out_index=n,s.strm.avail_out=l;var v=s.strm.avail_in;s.strm.next_in_index=h,s.strm.avail_in=d,s.hold=u,s.bits=p;var m=function(t,e,r){var i,n,s,c,f,l,u,p,h,d,g,v,m,w,b,y,_,k,z,S,x,C,E,T,A;i=t.state;var N=t.next_in_index,O=t.input,D=N+t.avail_in,M=t.next_out_index,L=t.output,P=M+t.avail_out,I=t.avail_in,R=t.avail_out,U=i.hold,j=i.bits,F=I,B=R,G=0;t:{for(;;){switch(i.mode){case 1:if(0===i.wrap)i.mode=2;else{for(j<16&&function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t);U=i.hold,16&U?i.mode=2:i.mode=13}break;case 2:for(;j<16;)if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),j<16){t.msg="invalid header check";break t}if(U=i.hold,15&(U>>8))t.msg="invalid method";else{if(8!=(15&U))break t;i.mode=3}case 3:for(;j<16;)if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),j<16){t.msg="invalid header check";break t}U=i.hold,i.mode=4;case 4:if(i.mode=5,U&512&&(t.msg="invalid reserved bit"),i.mode=6,t.msg)break t;i.mode=7;case 7:if(i.wrap)for(;j<32;)if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),j<32){t.msg="incorrect header check";break t}U=i.hold,t.adler,t.adler,i.mode=12,U=0,j=0;break;case 12:if(5===e)break t;case 13:if(0===i.wrap)i.mode=19;else{for(n=new Uint8Array(4),s=0;s<4;s++)n[s]=255&i.strm.adler,i.strm.adler>>=8;if(i.strm.adler=1,i.strm.adler=function t(e,r,i,n){for(var a=65535&e,s=e>>>16,c=0;i>0;){c=i>3800?3800:i;i-=c;do{a+=r[n++],s+=a}while(--c);a%=65521,s%=65521}return a|s<<16}(i.strm.adler,i.window,i.wsize,0),i.mode=14,i.mode=15,0===i.wsize){G=1;break t}}i.mode=19;case 19:for(i.write=0;i.read<i.write;){if(0===i.whave)break;i.whave--,i.window[i.wnext++]=i.window[i.read++],i.wnext===i.wsize&&(i.wnext=0),i.read===i.wsize&&(i.read=0)}if(0!==i.whave){if(B=R,t.avail_out=B,t.total_out+=B,i.whave-=B,B>i.whave?B-=i.whave:B=0,function(t,e,r){t.output.set(t.window.subarray(e,e+r),t.next_out_index),t.next_out_index+=r}(t,i.wnext-B,B),B)return B=R-B,t.avail_out=B,t.total_out+=B,B}G=1;break t;case 23:if(i.mode=24,i.lendyn&&(i.lendyn=null),i.distdyn&&(i.distdyn=null),i.lencode=null,i.distcode=null,j<16)if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),j<16)break t;if(U=i.hold,i.last=1&U,U>>>=1,j-=1,i.type=3&U,U>>>=2,j-=2,i.mode=25,j<16)if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),j<16)break t;switch(U=i.hold,i.type){case 0:U>>>=j&7,j=0,i.mode=27;break;case 1:d=new T(null,0,0,0,null),g=new T(null,0,0,0,null),A(d,C,288),A(g,E,32),i.lendyn=d,i.distdyn=g,i.mode=31;break;case 2:U>>>=j&7,j=0,i.mode=26;break;case 3:U>>>=j&7,j=0,t.msg="invalid block type";break t}break;case 26:for(;j<14;)if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),j<14){t.msg="invalid literal/lengths set";break t}if(U=i.hold,i.nlen=257+(31&U),U>>>=5,j-=5,i.ndist=1+(31&U),U>>>=5,j-=5,i.ncode=4+(15&U),U>>>=4,j-=4,i.nlen>286||i.ndist>30)break t;for(w=0;w<i.ncode;)i.work[w++]=0;for(w=0;w<i.ncode;)if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),j<3){t.msg="invalid code lengths set";break t}else U=i.hold,i.work[l[w++]]=7&U,U>>>=3,j-=3;for(;w<19;)i.work[l[w++]]=0;i.lendyn=new T(null,0,0,0,null),A(i.lendyn,i.work,19),i.mode=29;case 29:if(b=i.lendyn,w=0,v=i.nlen+i.ndist,m=b.max_length,j<m){if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),j<m)break t}for(U=i.hold,y=b.list[U&b.mask];;){if((_=(y>>4))<=m){U>>>=_,j-=_;break}if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),j<m)break t;U=i.hold,y=b.list[y&b.mask]}for(;;)if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),U=i.hold,y=b.list[U&b.mask],k=y>>4,z=y&15,k>j){t.msg="invalid code length";break t}else{if(U>>>=k,j-=k,w<v)for(S=0;S<z;S++)i.lens[w++]=k;if(16===k){if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),j<2){t.msg="invalid bit length repeat";break t}U=i.hold,x=3+(3&U),U>>>=2,j-=2;for(S=0;S<x;S++)i.lens[w++]=i.lens[w-1]}else if(17===k){if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),j<3){t.msg="invalid bit length repeat";break t}U=i.hold,x=3+(7&U),U>>>=3,j-=3;for(S=0;S<x;S++)i.lens[w++]=0}else if(18===k){if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),j<7){t.msg="invalid bit length repeat";break t}U=i.hold,x=11+(127&U),U>>>=7,j-=7;for(S=0;S<x;S++)i.lens[w++]=0}if(w>=v)break}if(t.msg)break t;i.distdyn=new T(null,0,0,0,null),A(i.distdyn,i.lens.subarray(i.nlen),i.ndist),i.lendyn=new T(null,0,0,0,null),A(i.lendyn,i.lens,i.nlen),i.mode=31;case 31:for(i.mode=32,c=i.lendyn,f=i.distdyn,m=c.max_length;j<m;)if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),j<m){t.msg="invalid literal/length code";break t}if(t.msg)break t;for(U=i.hold,y=c.list[U&c.mask];;){if((_=(y>>4))<=j){U>>>=_,j-=_;break}if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),j<m){t.msg="invalid literal/length code";break t}U=i.hold,y=c.list[U&c.mask]}if((_=(y>>4))<=j){U>>>=_,j-=_;break}for(;;)if((k=y&15)<256){if(0===R)break t;for(;R>0;)L[M++]=k,R--,i.whave<i.wsize&&(i.window[i.wnext++]=k,i.whave++),i.wnext===i.wsize&&(i.strm.adler=function t(e,r,i,n){for(var a=65535&e,s=e>>>16,c=0;i>0;){c=i>3800?3800:i;i-=c;do{a+=r[n++],s+=a}while(--c);a%=65521,s%=65521}return a|s<<16}(i.strm.adler,i.window,i.wsize,i.wnext-i.wsize),i.wnext=0,i.whave=i.wsize);i.mode=31}else{if(256===k){if(i.last){G=1;break t}i.mode=23;break}for(T=o[k-257],E=c[k-257],j<T&&function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),U=i.hold,i.length=E+(U&(1<<T)-1),U>>>=T,j-=T,m=f.max_length;j<m;)if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),j<m){t.msg="invalid distance code";break t}if(t.msg)break t;for(U=i.hold,y=f.list[U&f.mask];;){if((_=(y>>4))<=j){U>>>=_,j-=_;break}if(function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),j<m){t.msg="invalid distance code";break t}U=i.hold,y=f.list[U&f.mask]}T=o[k=y&15],E=c[k],j<T&&function(t){t.avail_in>0&&(t.hold+=t.input[t.next_in_index++]<<t.bits,t.bits+=8,t.avail_in--)}(t),U=i.hold,i.offset=E+(U&(1<<T)-1),U>>>=T,j-=T,p=M-R,i.offset>p?t.msg="invalid distance":function(t,e){for(var r,i,n,a=t.output,s=t.next_out_index,c=t.avail_out,f=t.state.wnext,l=t.state.wsize,u=t.state.window,p=l-f;e>c;)switch(r=s-t.state.offset,i=t.state.offset>p?p:t.state.offset,n=l-r,r>f?u.set(u.subarray(r,r+n),f):u.set(u.subarray(r,r+i),f),r+=i,f+=i,p-=i,i=s-t.state.offset,n=l-r,r>f?u.set(u.subarray(r,r+n),f):u.set(u.subarray(r,r+i),f),c-=i){case 1:a[s++]=u[f++];break;case 2:a[s++]=u[f++],a[s++]=u[f++];break;default:a.set(u.subarray(f,f+i),s),s+=i,f+=i}t.next_out_index=s,t.avail_out=c}(t,i.length)}}default:t.msg="unknown compression method";break t}},G}return t.avail_in=I,t.avail_out=R,t.next_in_index=N,t.next_out_index=M,t.total_in+=N-t.next_in_index,t.total_out+=M-t.next_out_index,i.hold=U,i.bits=j,i.wsize=i.wsize,i.whave=i.whave,i.wnext=i.wnext,i.write=i.write,i.read=i.read,0!==B||0===e&&0!==t.avail_in||0!==t.avail_out||i.last?(i.mode,t.msg&&-3,4===e&&function(t){var e=t.total_in,r=t.total_out;t.total_in=0,t.total_out=0,t.msg="",t.dstate&&(t.dstate.strm=null),t.istate&&(t.istate.strm=null),t.zfree=null,t.zalloc=null,t.opaque=null;var i=new w(t.options);return i.total_in=e,i.total_out=r,i}(t)?-2:0):-2},w.prototype.push=function(t,e){var r,i,s=this.state,c=t.length;if(s.ended)return!1;i=e===~~e?e:!0===e?4:0,s.strm.next_in=t,s.strm.next_in_index=0,s.strm.avail_in=c;do{if(0===s.strm.avail_out&&(s.strm.next_out=n?new Uint8Array(this.options.chunkSize):new Array(this.options.chunkSize),s.strm.next_out_index=0,s.strm.avail_out=this.options.chunkSize),1!==(r=O(s.strm,i))&&-2!==r)return this.onEnd(r),s.ended=!0,!1;s.strm.avail_out>0&&0===s.strm.avail_in||this.onData(s.strm.next_out.subarray(0,s.strm.next_out_index))}while(s.strm.avail_in>0||0===s.strm.avail_out);return 4!==i||(this.onEnd(0),s.ended=!0,this.err=0,this.msg="",!0)},r.deflate=function(t,e){var r,i,n,s,c,f=new w(e=e||{});if(f.err=0,f.msg="",f.ended=!1,f.chunks=[],f.options=e,r=f.options.chunkSize||16384,f.push(t,!0),f.err)throw f.msg||a[f.err];if(f.ended)return f.chunks.length>1?(i=f.chunks.length,n=new("string"==typeof f.chunks[0]?Array:Uint8Array)(f.result.length),s=0,c=0,f.chunks.forEach(function(t){"string"==typeof t?n.set(function(t,e){var r=e.length;t||(t=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(r));for(var i=0;i<r;i++)t[i]=255&e.charCodeAt(i);return t}(t),c):n.set(t,c),c+=t.length}),f.result=n):f.result=f.chunks[0];return f.result},r.deflateRaw=function(t,e){return(e=e||{}).raw=!0,r.deflate(t,e)},r.gzip=function(t,e){return(e=e||{}).gzip=!0,r.deflate(t,e)},r.inflate=function(t,e){var r,i,a,s,c,f,l,u,p,h,d,g,v,m,y,_,k,z,S,x,C,E,T=new w(e=e||{});if(T.push(t,!0),T.err)throw T.msg||N[T.err];if(T.ended)return T.chunks.length>1?T.result=T.chunks:T.result=T.chunks[0];T.err=0,T.msg="",T.ended=!1,T.chunks=[],T.options=e,T.options.chunkSize=T.options.chunkSize||16384,r=T.options.chunkSize,T.state.strm.avail_in=0,T.state.strm.next_in_index=0,T.state.strm.avail_out=r,T.state.strm.next_out_index=0,T.state.strm.next_out=n?new Uint8Array(r):new Array(r),a=0,s=T.chunks.length,c=0,f=T.result.length;for(l=0,u=s;l<u;l++)c+=T.chunks[l].length;for(l=0,u=c;l<u;l++)a+=T.chunks[l].length;for(p=new("string"==typeof T.chunks[0]?Array:Uint8Array)(a),l=0,u=T.chunks.length;l<u;l++)h=T.chunks[l],d=h.length,n?p.set(h,f):p.set(function(t,e){var r=e.length;t||(t=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(r));for(var i=0;i<r;i++)t[i]=255&e.charCodeAt(i);return t}(h),f),f+=d;return T.result=p},r.inflateRaw=function(t,e){return(e=e||{}).raw=!0,r.inflate(t,e)},r.ungzip=r.inflate,r.constants={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_VERSION_ERROR:-6,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}}).call("object"==typeof window?window:this)},{}]},{},[1])(1)});
    </script>
    <script>
    !function(a,b){if("function"==typeof define&&define.amd)define([],b);else if("undefined"!=typeof exports)b();else{b(),a.FileSaver={saveAs:a.saveAs}}}(this,function(){"use strict";function a(a,b){return"undefined"==typeof b?b=new Blob([a],{type:"video/webm"}):b instanceof Blob||(b=new Blob([a],{type:b})),b}function b(a,b){var c=new MouseEvent("click",{view:a,bubbles:!0,cancelable:!1});b.dispatchEvent(c)}function c(a){return/^https?:\/\//.test(a)?a:a.replace(location.origin,"")}function d(a){var b=a.split(";"),d=b.pop(),e=(b.shift()||"data:").split(",")[1],f={blob:e,encoding:d?d.split("=")[1]:"base64"};return f}function e(a){for(var b=a.length,c=new Uint8Array(b),d=0;d<b;d++)c[d]=a.charCodeAt(d);return c}function f(a){var b=a.encoding,c=new Blob(["base64"==b?e(a.blob):a.blob]);return c}function g(a,b){var c=this,d=a.type,g=!1,h,i,j;if(c.readyState=c.INIT,d||(d="application/octet-stream"),c.readyState===c.INIT)if(h=function(){var a=new(c.write=function(a){c.readyState=c.WRITING,c.writer.postMessage({type:c.WRITING,data:a})});a.onwrite=function(a){c.readyState=c.WRITING,c.onwrite(a)},a.onprogress=function(a){c.onprogress(a)},a.onwriteend=function(a){c.readyState=c.DONE,c.onwriteend(a)},a.onerror=function(a){c.readyState=c.DONE,c.onerror(a)},c.writer=a},b=b||"download.bin",c.readyState===c.INIT){var k="string"==typeof b?b:b.name||"download",l=new Blob;if(i="iframe",j='<iframe src="about:blank" style="display: none;" sandbox></iframe>',!g){var m=a.size,n=m>40960;if(n){if(c.readyState=c.INIT,c.INIT=0,c.WRITING=1,c.DONE=2,h(),c.readyState=c.WRITING,c.writer.postMessage({type:c.INIT,data:{name:k,size:m}}),c.onwrite=function(a){console.log("write")},!0)return}var o=document.createElement(i);o.src="about:blank",o.style.display="none",o.sandbox="",document.body.appendChild(o);var p=o.contentWindow.document;p.open(),p.write(j),p.close(),g=!0,c.readyState=c.INIT}}var q=new g,r=function(a,b,d){b=new Blob([d||b]),a.data=c.readyState=c.DONE,a.onwriteend(b)};q.onmessage=function(a){var b=a.data;c.readyState=c.DONE,c.onwriteend(b),q=null},c.readyState=c.INIT,r(c,l,a)}var h=window,i=h.navigator,j=h.document,k=h.URL||h.webkitURL||h,l=h.saveAs,m=h.webkitRequestFileSystem,n=h.requestFileSystem||m||h.mozRequestFileSystem,o=h.requestFileSystemSync||h.webkitRequestFileSystemSync||h.mozRequestFileSystemSync,p=h.Blob;h.saveAs=function(q,r,s){var t,u,v=h.document,w=function(){return q},x=function(){return!0},y=0,z="application/octet-stream",A=v.createElementNS("http://www.w3.org/1999/xhtml","a"),B="download"in A,C=function(a){var b=new MouseEvent("click");a.dispatchEvent(b)};if(s=!0,t=q,B)return u=t,A.href=k.createObjectURL(u),A.download=r,setTimeout(function(){C(A)}),void(A.href="");var D=function(a){var b=new p([a],{type:z});u=b,x(u)?l(u,r,s):k.revokeObjectURL(u.slice(0,u.size-1))};if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent)){var E=q;return E.constructor.name!="Blob"&&(E=new Blob([E],{type:"application/octet-stream"})),void(window.open(k.createObjectURL(E)))}if(!B&&"download"in A){var F=function(a){k.revokeObjectURL(a.target.href)};return A.href=k.createObjectURL(q),A.target="_blank",A.addEventListener("click",F),void setTimeout(function(){C(A)},0)}if(n&&"download"in A){A.href=k.createObjectURL(q),A.download=r;var G=function(a){var b=a.target,c=b.download;setTimeout(function(){k.revokeObjectURL(b.href)},3e4)};return A.addEventListener("click",G),void C(A)}if(n&&h.chrome){var H=q.constructor.name=="Blob"?q.size:q.length;return n(h.TEMPORARY,H,function(a){a.root.getFile(r,{create:!0},function(b){b.createWriter(function(c){c.onwriteend=function(a){var b=document.createElement("a");b.href=this.localURL,b.download=r,C(b)},c.write(q)})},D)},void D(q))}var I=function(){var a=document.createElement("iframe");a.src="about:blank",a.style.display="none",document.body.appendChild(a),window.setTimeout(function(){a.contentWindow.document.open(),a.contentWindow.document.write("<script>document.body.innerHTML='<a download="+r+" href="+window.URL.createObjectURL(q)+" style=\"display: none;\"></a>'</sc"+"ript>"),a.contentWindow.document.close(),var b=a.contentWindow.document.body.firstChild;setTimeout(function(){b.click(),document.body.removeChild(a)},0)},0)};if("data:"==q.substring(0,5))return void(window.location.href=q);I()},h.saveAs.unload=function(){l=h.saveAs,h.saveAs=function(){throw new Error("You can't call saveAs from unload event")}},h.saveAs.readyState=h.saveAs.INIT=0,h.saveAs.WRITING=1,h.saveAs.DONE=2,h.saveAs.prototype={WRITING:1,INIT:0,DONE:2,abort:function(){this.readyState=this.DONE},onwritestart:function(){},onprogress:function(){},onwrite:function(){},onwriteend:function(){},onerror:function(){}}});
    </script>
    
    <script>
        // DOM 元素引用
        const inputTextarea = document.getElementById('inputText');
        const fileUploadInput = document.getElementById('fileUpload');
        const qrSizeInput = document.getElementById('qrSize');
        const qrFgColorInput = document.getElementById('qrFgColor');
        const qrBgColorInput = document.getElementById('qrBgColor');
        const qrErrorCorrectionSelect = document.getElementById('qrErrorCorrection');
        const logoUploadInput = document.getElementById('logoUpload');
        const logoPreviewContainer = document.getElementById('logoPreviewContainer');
        const logoSizeRatioInput = document.getElementById('logoSizeRatio');
        const logoSizeRatioValueSpan = document.getElementById('logoSizeRatioValue');
        const generateButton = document.getElementById('generateButton');
        const buttonTextSpan = document.getElementById('buttonText');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const errorMessageDiv = document.getElementById('errorMessage');
        const resultsContainer = document.getElementById('resultsContainer');
        const qrCodeGrid = document.getElementById('qrCodeGrid');
        const downloadQrCodesZipButton = document.getElementById('downloadQrCodesZip');

        // 應用程式狀態
        let qrCodeLogoDataUrl = null;
        let generatedResults = []; // 儲存所有生成結果

        // --- 事件監聽器 ---
        fileUploadInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    inputTextarea.value = e.target.result;
                };
                reader.readAsText(file);
            }
        });

        logoUploadInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    qrCodeLogoDataUrl = e.target.result;
                    logoPreviewContainer.classList.remove('hidden');
                    logoPreviewContainer.classList.add('flex');
                };
                reader.readAsDataURL(file);
            } else {
                qrCodeLogoDataUrl = null;
                logoPreviewContainer.classList.add('hidden');
                logoPreviewContainer.classList.remove('flex');
            }
        });

        logoSizeRatioInput.addEventListener('input', (event) => {
            logoSizeRatioValueSpan.textContent = `${(parseFloat(event.target.value) * 100).toFixed(0)}%`;
        });

        generateButton.addEventListener('click', handleGenerate);
        downloadQrCodesZipButton.addEventListener('click', downloadQrCodesAsZip);

        // --- 核心生成邏輯 ---
        async function handleGenerate() {
            errorMessageDiv.classList.add('hidden');
            resultsContainer.classList.add('hidden');
            qrCodeGrid.innerHTML = '';
            generatedResults = [];

            const lines = inputTextarea.value.split('\n')
                .map(line => line.trim())
                .filter(line => line !== '');

            if (lines.length === 0) {
                errorMessageDiv.textContent = '請輸入要生成的內容或上傳檔案。';
                errorMessageDiv.classList.remove('hidden');
                return;
            }

            setLoadingState(true);

            if (!window.QRCode) {
                errorMessageDiv.textContent = 'QR Code 函式庫未載入。請稍後再試。';
                errorMessageDiv.classList.remove('hidden');
                setLoadingState(false);
                return;
            }
            
            for (let i = 0; i < lines.length; i++) {
                const content = lines[i];
                try {
                    const canvas = document.createElement('canvas');
                    const qrSize = parseInt(qrSizeInput.value) || 256;
                    const fgColor = qrFgColorInput.value;
                    const bgColor = qrBgColorInput.value;
                    const errorCorrectionLevel = qrErrorCorrectionSelect.value;
                    const logoSizeRatio = parseFloat(logoSizeRatioInput.value);

                    await new Promise((resolve, reject) => {
                        window.QRCode.toCanvas(canvas, content, {
                            width: qrSize,
                            margin: 2,
                            color: {
                                dark: fgColor,
                                light: bgColor
                            },
                            errorCorrectionLevel: errorCorrectionLevel
                        }, function (error) {
                            if (error) reject(error);
                            else resolve();
                        });
                    });

                    // 繪製 Logo
                    if (qrCodeLogoDataUrl) {
                        const ctx = canvas.getContext('2d');
                        const img = new Image();
                        img.src = qrCodeLogoDataUrl;
                        await new Promise((resolve, reject) => {
                            img.onload = () => {
                                const logoSize = qrSize * logoSizeRatio;
                                const x = (qrSize - logoSize) / 2;
                                const y = (qrSize - logoSize) / 2;
                                ctx.fillStyle = bgColor;
                                ctx.fillRect(x - 5, y - 5, logoSize + 10, logoSize + 10);
                                ctx.drawImage(img, x, y, logoSize, logoSize);
                                resolve();
                            };
                            img.onerror = reject;
                        });
                    }

                    generatedResults.push({
                        id: `qr-${i}`,
                        original: content,
                        dataUrl: canvas.toDataURL('image/png')
                    });
                } catch (error) {
                    console.error('生成 QR Code 失敗:', error);
                    generatedResults.push({
                        id: `qr-${i}`,
                        original: content,
                        error: '生成失敗'
                    });
                }
            }

            displayResults();
            setLoadingState(false);
        }

        // --- 結果顯示與下載 ---
        function displayResults() {
            resultsContainer.classList.remove('hidden');
            qrCodeGrid.innerHTML = '';

            generatedResults.forEach((item) => {
                const div = document.createElement('div');
                div.className = 'bg-white p-4 rounded-xl shadow-md border border-gray-100 flex flex-col items-center text-center';
                if (item.error) {
                    div.innerHTML = `
                        <p class="text-sm text-gray-600 break-all mb-2">${item.original}</p>
                        <p class="text-red-500 font-semibold">${item.error}</p>`;
                } else {
                    const safeFilename = item.original.replace(/[^a-z0-9]/gi, '_').substring(0, 30);
                    div.innerHTML = `
                        <img src="${item.dataUrl}" alt="QR Code for ${item.original}" class="w-40 h-40 mb-3 border border-gray-200 rounded-lg">
                        <p class="text-xs text-gray-500 break-all mb-3">${item.original}</p>
                        <a href="${item.dataUrl}" download="qrcode_${safeFilename}.png" class="mt-auto px-4 py-2 bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-600 transition duration-200 ease-in-out">
                            下載
                        </a>
                    `;
                }
                qrCodeGrid.appendChild(div);
            });
        }

        async function downloadQrCodesAsZip() {
            if (!window.JSZip || !window.saveAs) {
                errorMessageDiv.textContent = 'JSZip 或 FileSaver 函式庫未載入。';
                errorMessageDiv.classList.remove('hidden');
                return;
            }
            const zip = new window.JSZip();
            const qrCodeResults = generatedResults.filter(r => r.dataUrl);

            if (qrCodeResults.length === 0) {
                errorMessageDiv.textContent = '沒有可下載的 QR Code 圖片。';
                errorMessageDiv.classList.remove('hidden');
                return;
            }

            qrCodeResults.forEach((item, index) => {
                const base64Data = item.dataUrl.split(',')[1];
                const safeFilename = item.original.replace(/[^a-z0-9]/gi, '_').substring(0, 30);
                zip.file(`qrcode_${index + 1}_${safeFilename}.png`, base64Data, { base64: true });
            });

            zip.generateAsync({ type: 'blob' })
                .then(function (content) {
                    window.saveAs(content, 'qrcodes.zip');
                })
                .catch(error => {
                    errorMessageDiv.textContent = '打包 QR Code 時發生錯誤。';
                    errorMessageDiv.classList.remove('hidden');
                    console.error('ZIP 生成失敗:', error);
                });
        }

        // --- UI 狀態管理 ---
        function setLoadingState(isLoading) {
            if (isLoading) {
                buttonTextSpan.classList.add('hidden');
                loadingSpinner.classList.remove('hidden');
                loadingSpinner.classList.add('flex');
                generateButton.disabled = true;
            } else {
                buttonTextSpan.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
                loadingSpinner.classList.remove('flex');
                generateButton.disabled = false;
            }
        }
    </script>
</body>
</html>
